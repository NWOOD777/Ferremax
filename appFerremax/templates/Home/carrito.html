<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Carrito de Compras</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'CSS/carrito.css' %}">
</head>
<body>
<div class="cart-container">
    <h2>Carrito de Compras</h2>
    <div id="cart-items-container"></div>
</div>
        
    </div> <!-- cierre de .cart-container de los productos -->

    <div class="cart-summary">
        <div class="total-block">
            <span>Total:</span>
            <span class="total-price" id="totalPrice">$25.00</span>
        </div>
        <div class="paypal-block">
            <div id="paypal-button-container"></div>
        </div>
    </div>

    <script src="https://www.paypal.com/sdk/js?client-id=AbdaK_ZgX-MH7UmJvqbCPJN0qmgV0KWjkkKmFnOypZdVqfu2Oh7bfNSceQ0kijnLLk9Nkc4ATu55K9eD&currency=USD"></script>
  <script>
    function actualizarTotal() {
        let total = 0;
        document.querySelectorAll('.cart-item').forEach(function(item) {
            const precio = parseFloat(item.querySelector('.cart-item-price').textContent.replace('$', ''));
            const cantidad = parseInt(item.querySelector('.quantity').textContent, 10);
            total += precio * cantidad;
        });
        document.getElementById('totalPrice').textContent = '$' + total.toFixed(2);
    }

    // Listeners para botones de cantidad y eliminar
    document.querySelectorAll('.cart-item').forEach(function(item) {
        const decreaseBtn = item.querySelector('.decrease-btn');
        const increaseBtn = item.querySelector('.increase-btn');
        const quantitySpan = item.querySelector('.quantity');
        const removeBtn = item.querySelector('.remove-button');

        decreaseBtn.addEventListener('click', function() {
            let qty = parseInt(quantitySpan.textContent, 10);
            if (qty > 1) {
                quantitySpan.textContent = qty - 1;
                actualizarTotal();
            }
        });

        increaseBtn.addEventListener('click', function() {
            let qty = parseInt(quantitySpan.textContent, 10);
            quantitySpan.textContent = qty + 1;
            actualizarTotal();
        });

        removeBtn.addEventListener('click', function() {
            item.remove();
            actualizarTotal();
        });
    });

    actualizarTotal();

    paypal.Buttons({
        createOrder: function(data, actions) {
            const total = parseFloat(document.getElementById('totalPrice').textContent.replace('$', ''));
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: total.toFixed(2)
                    },
                    description: "Carrito Ferremax"
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                alert('Pago realizado por ' + details.payer.name.given_name);
            });
        }
    }).render('#paypal-button-container');
</script>
<script>
  function renderCart() {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let container = document.getElementById('cart-items-container');
    container.innerHTML = '';
    let total = 0;
    cart.forEach((item, idx) => {
      total += item.price * item.quantity;
      container.innerHTML += `
        <div class="cart-item">
          <div class="cart-item-details">
            <img src="${item.img}" alt="Producto" style="width:50px;height:50px;">
            <span class="cart-item-name">${item.name}</span>
          </div>
          <span class="cart-item-price">$${item.price.toLocaleString()}</span>
          <div class="cart-item-quantity">
            <button class="decrease-btn" data-idx="${idx}">-</button>
            <span class="quantity">${item.quantity}</span>
            <button class="increase-btn" data-idx="${idx}">+</button>
          </div>
          <button class="remove-button" data-idx="${idx}">Eliminar</button>
        </div>
      `;
    });
    document.getElementById('totalPrice').textContent = '$' + total.toLocaleString();
    addCartListeners();
  }

  function addCartListeners() {
    document.querySelectorAll('.decrease-btn').forEach(btn => {
      btn.onclick = function() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let idx = parseInt(btn.getAttribute('data-idx'));
        if (cart[idx].quantity > 1) cart[idx].quantity--;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    });
    document.querySelectorAll('.increase-btn').forEach(btn => {
      btn.onclick = function() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let idx = parseInt(btn.getAttribute('data-idx'));
        cart[idx].quantity++;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    });
    document.querySelectorAll('.remove-button').forEach(btn => {
      btn.onclick = function() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let idx = parseInt(btn.getAttribute('data-idx'));
        cart.splice(idx, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    });
  }

  // Inicializar carrito al cargar la página
  renderCart();
</script>

<script>
  function renderCart() {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let container = document.getElementById('cart-items-container');
    container.innerHTML = '';
    let total = 0;
    cart.forEach((item, idx) => {
      total += item.price * item.quantity;
      container.innerHTML += `
        <div class="cart-item">
          <div class="cart-item-details">
            <img src="${item.img}" alt="Producto" style="width:50px;height:50px;">
            <span class="cart-item-name">${item.name}</span>
          </div>
          <span class="cart-item-price">$${item.price.toLocaleString()}</span>
          <div class="cart-item-quantity">
            <button class="decrease-btn" data-idx="${idx}">-</button>
            <span class="quantity">${item.quantity}</span>
            <button class="increase-btn" data-idx="${idx}">+</button>
          </div>
          <button class="remove-button" data-idx="${idx}">Eliminar</button>
        </div>
      `;
    });
    document.getElementById('totalPrice').textContent = '$' + total.toLocaleString();
    addCartListeners();
  }

  function addCartListeners() {
    document.querySelectorAll('.decrease-btn').forEach(btn => {
      btn.onclick = function() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let idx = parseInt(btn.getAttribute('data-idx'));
        if (cart[idx].quantity > 1) cart[idx].quantity--;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    });
    document.querySelectorAll('.increase-btn').forEach(btn => {
      btn.onclick = function() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let idx = parseInt(btn.getAttribute('data-idx'));
        cart[idx].quantity++;
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    });
    document.querySelectorAll('.remove-button').forEach(btn => {
      btn.onclick = function() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let idx = parseInt(btn.getAttribute('data-idx'));
        cart.splice(idx, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
      }
    });
  }

  // Inicializar carrito al cargar la página
  renderCart();
</script>

</body>
</html>